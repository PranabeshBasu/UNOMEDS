<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UNOMEDS – Symptom Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: rgba(17, 24, 39, 0.9);
      --bubble-user: rgba(37, 99, 235, 0.9);
      --bubble-bot: rgba(31, 41, 55, 0.9);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22c55e;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: url('static/assets/sys.jpg') center/cover no-repeat fixed;
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      min-height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr auto;
      position: relative;
    }
    
    /* Dark overlay for better readability */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: -1;
    }
    
    header {
      padding: 20px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.8);
      display: flex; 
      align-items: center; 
      justify-content: center;
      gap: 10px;
      background: rgba(17, 24, 39, 0.9);
      backdrop-filter: blur(10px);
      position: sticky; 
      top: 0; 
      z-index: 5;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    header h1 { 
      margin: 0; 
      font-size: 20px; 
      letter-spacing: .5px; 
      font-weight: 600; 
      text-align: center;
    }
    header .badge { 
      font-size: 12px; 
      color: var(--muted); 
      background: rgba(34, 197, 94, 0.2);
      padding: 4px 8px;
      border-radius: 12px;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }
    
    #chat {
      padding: 30px 20px;
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      display: flex; 
      flex-direction: column; 
      gap: 20px;
      min-height: 0;
      overflow-y: auto;
      border: rgba(255,255,255,0.1);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3)
    }
    
    .msg {
      display: flex; 
      gap: 12px; 
      align-items: flex-start;
      justify-content: center;
      width: 100%;
    }
    
    .msg .bubble {
      padding: 16px 18px;
      border-radius: 16px;
      max-width: 75%;
      line-height: 1.5;
      box-shadow: 0 8px 25px rgba(0,0,0,.4);
      border: 1px solid rgba(255,255,255,0.1);
      word-wrap: break-word; 
      white-space: pre-wrap;
      backdrop-filter: blur(15px);
    }
    
    .user {
      justify-content: flex-end;
    }
    
    .user .bubble { 
      background: var(--bubble-user);
      margin-left: auto;
    }
    
    .bot {
      justify-content: flex-start;
    }
    
    .bot .bubble { 
      background: var(--bubble-bot);
      margin-right: auto;
    }
    
    .from { 
      font-size: 12px; 
      color: var(--muted); 
      margin-bottom: 8px; 
      font-weight: 600;
    }
    
    .AiBlock { 
      display: grid; 
      gap: 12px; 
    }
    
    .cond {
      padding: 14px; 
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px; 
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
    }
    
    .row { 
      display: flex; 
      justify-content: space-between; 
      gap: 10px; 
      flex-wrap: wrap; 
    }
    
    .cond .name { 
      font-weight: 600; 
      color: #ffffff;
    }
    
    .bar {
      height: 10px; 
      background: rgba(255,255,255,0.15);
      border-radius: 999px; 
      overflow: hidden; 
      margin-top: 10px;
    }
    
    .bar > span {
      display: block; 
      height: 100%; 
      background: linear-gradient(90deg, #22c55e, #16a34a);
      width: 0%;
      transition: width .8s ease;
    }
    
    .redflags {
      border-left: 4px solid var(--danger);
      padding: 14px 16px; 
      background: rgba(239,68,68,0.15);
      border-radius: 10px; 
      font-size: 14px;
      backdrop-filter: blur(10px);
    }
    
    #composer {
      max-width: 900px; 
      width: 100%; 
      margin: 0 auto 25px;
      display: grid; 
      grid-template-columns: 1fr auto; 
      gap: 12px;
      padding: 20px;
    }
    
    #input {
      padding: 16px 18px;
      background: rgba(17, 24, 39, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.8);
      color: var(--text);
      border-radius: 14px;
      font-size: 15px;
      outline: none;
      backdrop-filter: blur(15px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }
    
    #input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    }
    
    button {
      background: var(--accent);
      color: #052e16;
      font-weight: 700;
      border: none;
      padding: 0 22px;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
      font-size: 15px;
    }
    
    button:hover {
      background: #16a34a;
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
    }
    
    button:active { 
      transform: translateY(1px); 
    }
    
    .typing { 
      color: var(--muted); 
      font-size: 14px; 
    }
    
    .disclaimer { 
      color: var(--muted); 
      font-size: 12px; 
      margin-top: 10px; 
      padding: 10px;
      background: rgba(255, 193, 7, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(255, 193, 7, 0.2);
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      #chat {
        padding: 20px 15px;
      }
      
      #composer {
        padding: 15px;
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      button {
        width: 100%;
        padding: 16px;
      }
      
      .msg .bubble {
        max-width: 90%;
      }
      
      header {
        padding: 15px;
        flex-direction: column;
        gap: 5px;
      }
      
      header h1 {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>UNOMEDS – Symptom Checker</h1>
  </header>

  <main id="chat">
    <div class="msg bot">
      <div class="bubble">
        <div class="from">UNOMEDS</div>
        Hi! What are your symptoms? Please include duration, severity, triggers, fever, pain location, meds taken, and key medical history if relevant.
      </div>
    </div>
  </main>

  <form id="composer" onsubmit="sendMessage(event)">
    <input id="input" type="text" placeholder="e.g., fever 38.5°C for 2 days, sore throat, dry cough, mild headache" />
    <button type="submit">Send</button>
  </form>

  <script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("input");
    let busy = false;

    function addUser(text) {
      const el = document.createElement("div");
      el.className = "msg user";
      el.innerHTML = `<div class="bubble"><div class="from">You</div>${escapeHtml(text)}</div>`;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }

    function addTyping() {
      const el = document.createElement("div");
      el.className = "msg bot typing";
      el.innerHTML = `<div class="bubble"><div class="from">unoBOT</div>Analyzing symptoms…</div>`;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
      return el;
    }

    function addBotAnalysis(data) {
      const el = document.createElement("div");
      el.className = "msg bot";
      const flags = (data.red_flags || []);
      const conds = (data.conditions || []);
      let html = `<div class="bubble"><div class="from">unoBOT</div><div class="AiBlock">`;

      if (conds.length === 0) {
        html += `<div>No analysis available right now.</div>`;
      } else {
        conds.forEach((c, i) => {
          const pct = Number(c.probability || 0);
          html += `
            <div class="cond">
              <div class="row">
                <div class="name">${escapeHtml(c.condition || "Condition")}</div>
                <div>${pct}% · ${escapeHtml((c.severity || "unknown").toString())}</div>
              </div>
              <div>${escapeHtml(c.rationale || "")}</div>
              <div class="bar"><span style="width:${pct}%"></span></div>
            </div>
          `;
        });
      }

      if (flags.length > 0) {
        html += `<div class="redflags"><strong>Potential red flags:</strong> ${flags.map(escapeHtml).join("; ")}</div>`;
      }

      if (data.disclaimer) {
        html += `<div class="disclaimer">${escapeHtml(data.disclaimer)}</div>`;
      }

      html += `</div></div>`;
      el.innerHTML = html;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }

    function escapeHtml(str) {
      return (str || "").toString()
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    async function sendMessage(e) {
      e.preventDefault();
      if (busy) return;
      const text = input.value.trim();
      if (!text) return;

      busy = true;
      addUser(text);
      input.value = "";
      const typingEl = addTyping();

      try {
        const resp = await fetch("http://127.0.0.1:8010/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });
        const data = await resp.json();
        typingEl.remove();
        addBotAnalysis(data);
      } catch (err) {
        typingEl.remove();
        const el = document.createElement("div");
        el.className = "msg bot";
        el.innerHTML = `<div class="bubble"><div class="from">unoBOT</div>Sorry, there was a network error.</div>`;
        chat.appendChild(el);
      } finally {
        busy = false;
        input.focus();
      }
    }

    // Enter to send
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        document.getElementById("composer").dispatchEvent(new Event("submit"));
      }
    });
  </script>
</body>
</html>